
<% content_for :head do -%>

  <meta property="og:image" content="<%= @article.image_url %>" />
  <meta property="og:url" content="<%= @article.image_url %>" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="<%= @article.headline %>" />
  <meta property="og:description" content="<%= @article.description %>" />
  <meta property="og:site_name" content="<%= @article.site_name %>" />
  <meta property="fb:app_id" content="<%=ENV['FACEBOOK_APP_ID'] %>" />

<% end -%>



<%= render :layout => "article/shared/article_interact" do %>

  article.id = <%= @article.id %>

  get_article_from_server()

  function get_article_from_server()
  {

    request = $.ajax({
      //url: "http://thawing-thicket-8101.herokuapp.com/articles/add_new_article",
      url: "/articles/get_article",
      type: "get",
      //data: { URL: document.referrer },
      data: article,
      error: function (xhr, ajaxOptions, thrownError) {
            alert(xhr.status);
            alert(thrownError);
          },
          dataType: 'json',
      });

    // callback handler that will be called on success
    request.done(function (response, textStatus, jqXHR)
    {
      // log a message to the console
      $('#contents').css('visibility', 'visible')

      $('#article_headline').html(response.headline)
      $('#article_author').html(response.author)
      $('#article_source').html(response.site_name)    

      $('#article_image').attr("src", response.image_url)
      

      $('#article_content').html(response.content)

      article.content = response.content
      article.site_name = response.site_name
      article.author = response.author
      article.headline = response.headline

      article.url = '<%= ENV['domain'] %>' + '/articles/public/' + response.id
      article.image_url = response.image_url
      article.id = response.id

      get_comments()
      enable_commenting() 

    });
  }

  function get_comments()
  {
    var get_request = new Object()
    get_request.article_id = <%= @article.id %>

    var url = '/comment/get_article_comments'

    $.get(url, get_request).done(function(data) 
      { 
        all_comments = data

        // turn ids into a JSON object
        for(var x in all_comments)
        {

          all_comments[x].comment_location_ids = $.parseJSON(all_comments[x].comment_location_ids)
        
        }


        get_users()
        

      })
  }



<% end %>
